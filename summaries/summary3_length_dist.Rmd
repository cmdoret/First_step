---
title: 'Report 3: Length distributions'
author: "Cyril Matthey-Doret"
date: "11 octobre 2016"
output: pdf_document
---

```{r setup, include=FALSE}
#Loading data
#setwd("/home/cyril/Documents/Master/sem_1/First_step/data/")
setwd("/home/cyril/Documents/First_step/data/")
#setwd("/Users/cmatthe5/Documents/First_step/data/")
library(ggplot2)
library(gridExtra)
m.TAD<- read.table("../data/TAD/merged/merged_TAD.bed") #merged TADs, or "Large TADs"
m.TAD <- cbind(paste("merged",row.names(m.TAD),sep="_"),m.TAD) #adding arbitrary ID to TADs just in case
TAD <- read.table("../data/TAD/GM12878_TAD_domains.bed") #original TADs, high number of overlapping domains
TAD <- TAD[,-4]
colnames(TAD) <- c("chr","start","end","ID")
colnames(m.TAD) <- c("ID","chr","start","end")
m.gap <- read.table("../data/TAD/merged/gaps.bed") #gaps between merged TADs
m.TAD_b5 <- read.table("../data/TAD/merged/TAD_boundaries5.bed")
m.TAD_b10 <- read.table("../data/TAD/merged/TAD_boundaries10.bed")
m.TAD_b20 <- read.table("../data/TAD/merged/TAD_boundaries20.bed")
m.TADbins <- read.table("../data/TAD/merged/merged_TADbins.txt")
m.TADbound <- read.table("../data/TAD/merged/whole_TAD_boundaries.txt")
colnames(m.TADbound)=colnames(m.TADbins) <- c("ID","chr","pos","start","end")
RNAcount_bin <- read.table("../data/TAD/merged/RNAcount_TADbins.txt")
colnames(RNAcount_bin) <- c("ID","chr","pos","start","end","lincRNA","pcgene")
  
```

#Introduction

Visualising and quantifying the distribution of TAD lengths, or the areas of ovelap between lincRNAs and TADs might help finding a better threshold for the definition of TAD boundaries. This report aims to provide support for the definition of those boundaries.

#1. Length distribution of TAD, boundaries and gaps
   + Length of TADs:
   TADs often contained many smaller TADs which causes the boundaries to overlap and makes it harder to distinguish between TAD-bound and non-TAD-bound RNAs. 
   
```{r TAD_length, echo=F, warning=F, error=F, fig.height=5, fig.width=6}

options(scipen=4)
dist_TAD <-ggplot(data=TAD)+
  geom_histogram(aes(x=log10(end-start),y=..count..),fill="#5555cc",bins = 30)+
  coord_cartesian(xlim = c(4.5,6.5))+
  xlab(label = "")+
  theme_bw()
dist_mTAD <-ggplot(data=m.TAD)+
  geom_histogram(aes(x=log10(end-start),y=..count..),fill="#55cc55",bins = 30)+
  coord_cartesian(xlim = c(4.5,6.5))+
  xlab(label = "Log10 Length")+
  theme_bw()
dist_TADvsmTAD <-ggplot()+
  geom_boxplot(data=TAD,aes(x="original TADs",y=log10(end-start)),fill="#5555cc",notch = T)+
  geom_boxplot(data=m.TAD,aes(x = "Large TADs",y=log10(end-start)),fill="#55cc55",notch = T)+
  ylab(label = "Log10 Length")+
  annotate(geom = "label",x = c(1,2),y=6,label=c(paste0("Mdn=",format(as.numeric(median(m.TAD$end-m.TAD$start)),scientific=T)),
                                                 paste0("Mdn=",format(median(TAD$end-TAD$start),scientific = T))))+
  xlab(paste0("p-value=",format(wilcox.test(m.TAD$end-m.TAD$start,TAD$end-TAD$start)$p.value,digits=2)))+
  theme_bw()
grid.arrange(layout_matrix = matrix(c(1,3,2,3),nrow = 2,byrow = T),grobs = list(dist_TAD,dist_mTAD,dist_TADvsmTAD))
options(scipen=0)

```

   + Length of TAD boundaries:
   TAD boundaries have been redefined so that they are more flexible. Again, three different thresholds have been used to define them, however a boundary cannot overlap another. A TAD boundary will always reach only as far as the smallest value between the threshold and half the gap between its TAD and the neighbour.
   
```{r boundaries_length, echo=F, warning=F, error=F, fig.height=5, fig.width=6}
ext.m.TADbound <- data.frame(m.TADbound, side=substr(m.TADbound$pos,1,1), threshold=strsplit(as.character(m.TADbound$pos),2,nchar(as.character(m.TADbound$pos))))
ggplot(data=m.TADbound)+
  facet_grid(substr(pos,1,1)~strsplit(pos,2,nchar(pos)))+
  geom_boxplot(aes(y=end-start))


```

#2. Overlaps between RNA and areas of TAD boundaries

#3. ...